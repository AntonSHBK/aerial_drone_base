# PX 4

Вы абсолютно правы, что команда `make px4_sitl_default gazebo_custom_drone` в контексте PX4 связана с симуляцией, но позвольте уточнить детали, чтобы полностью прояснить её значение и функции.

### Что такое `px4_sitl_default`?

`px4_sitl_default` — это таргет сборки в системе сборки PX4, который ориентирован на запуск программного обеспечения PX4 в режиме SITL (Software In The Loop). Этот режим позволяет запускать полную систему управления PX4 в виртуальном окружении без необходимости физического аппаратного обеспечения.

- **PX4 SITL (Software In The Loop)**: Это симуляция, которая позволяет разработчикам тестировать и отлаживать свои системы управления в реалистичной симуляции перед реальным полетом. Это помогает выявить и устранить ошибки в безопасной среде, экономя время и ресурсы.

- **Default**: Слово "default" в `px4_sitl_default` указывает на стандартную конфигурацию SITL. Это базовая настройка, которая подходит для большинства симуляций и обычно включает стандартные параметры и настройки, которые подходят для общих целей тестирования.

### Команда `make px4_sitl_default gazebo_custom_drone`

Когда вы вызываете эту команду:

- `make` — это утилита для автоматизации сборки программного обеспечения, которая читает файлы `Makefile` и выполняет задачи сборки.
- `px4_sitl_default` — таргет для сборки, который подготавливает и настраивает окружение для запуска PX4 в режиме SITL.
- `gazebo_custom_drone` — это указание на то, что сборка должна использовать Gazebo в качестве симулятора и загружать модель `custom_drone`, которую вы создали.

### Как это работает?

1. **Сборка PX4**: Система сборки конфигурирует и компилирует PX4 для работы в симулированной среде на вашем компьютере.
2. **Запуск Gazebo**: Автоматически запускает Gazebo, симулятор, который поддерживает динамическое моделирование и визуализацию дронов.
3. **Загрузка Модели**: Ваша кастомная модель `custom_drone` загружается в Gazebo, позволяя вам наблюдать и тестировать её поведение.

Использование этой команды позволяет разработчикам увидеть, как их программное обеспечение взаимодействует с моделью дрона в реалистичных условиях, что является ключевым аспектом разработки систем БПЛА.

`px4_sitl` — это конфигурация проекта PX4, предназначенная для симуляции работы программного обеспечения дрона в среде SITL (Software In The Loop). В контексте PX4, `px4_sitl` обозначает специфическую настройку, которая позволяет полетному контроллеру (flight controller software) работать на обычном компьютере в качестве процесса, имитирующего реальную работу дрона без использования физического аппаратного обеспечения. Это включает в себя эмуляцию сенсоров, взаимодействие с внешним миром через протоколы связи и исполнение полетных команд.

### Компоненты `px4_sitl`

1. **Эмуляция Сенсоров и Аппаратуры**
   - В SITL используется виртуализация датчиков, таких как гироскопы, акселерометры, магнитометры, GPS и других. Это позволяет полетному стеку PX4 работать так, как если бы он общался с реальными устройствами.

2. **Взаимодействие с Симуляторами**
   - `px4_sitl` может взаимодействовать с различными внешними симуляторами, такими как Gazebo, jMAVSim и AirSim. Это обеспечивает динамическую среду для тестирования алгоритмов управления, систем навигации и аварийных процедур.

3. **Исполнение Программного Обеспечения**
   - Тот же код, который запускается на реальном полетном контроллере, выполняется в симуляции. Это включает все аспекты управления полетом, включая обработку входных данных, расчеты PID контроллеров, планирование миссий и обработку MAVLink сообщений.

4. **Параметризация и Конфигурация**
   - `px4_sitl` позволяет динамически настраивать параметры полета и оборудования, что крайне полезно при тестировании нового оборудования или алгоритмов. Параметры можно изменять через интерфейс QGroundControl или программно через MAVLink.

5. **Тестирование и Разработка**
   - Разработчики и инженеры могут использовать `px4_sitl` для разработки и тестирования нового программного обеспечения, алгоритмов или для подготовки к участию в соревнованиях беспилотников, не рискуя дорогим оборудованием.

# Описание доступных моделей

PX4 SITL (Software in the Loop) включает в себя несколько предварительно настроенных моделей дронов для использования в симуляциях с Gazebo, из которых наиболее заметная и часто используемая — это модель **Iris**. Рассмотрим эту и другие популярные модели, предоставляемые PX4:

### Iris
**Iris** — это квадрокоптер, который часто используется в качестве базовой платформы для тестирования и разработки в PX4. Это виртуальное представление реального дрона Iris от 3D Robotics, который был популярен среди любителей и исследователей.

- **Особенности**:
  - Виртуальная модель Iris в Gazebo включает имитации датчиков, таких как GPS, гирокомпас, акселерометр и магнитометр.
  - Имеет камеры и гимбал для камеры, что позволяет использовать её в задачах компьютерного зрения и фотограмметрии.
  - Оптимизирована для тестирования алгоритмов полетного управления, включая взлет, посадку, точечное наведение и миссии с использованием планировщика маршрутов.

### Standard Plane
**Standard Plane** — это модель фиксированного крыла, предназначенная для тестирования алгоритмов управления полетом для самолетов.

- **Особенности**:
  - Имитирует поведение реального самолета с фиксированным крылом.
  - Используется для разработки и тестирования алгоритмов управления, включая взлет, посадку и крейсерский полет.

### Standard VTOL
**Standard VTOL (Vertical Take-Off and Landing)** — это модель, которая комбинирует характеристики квадрокоптера и самолета с фиксированным крылом.

- **Особенности**:
  - Поддерживает вертикальный взлет и посадку, что делает его идеальным для операций в ограниченном пространстве.
  - Может переходить в горизонтальный полет, что обеспечивает высокую скорость и дальность полета.
  - Используется для тестирования сложных сценариев управления и переходов между различными режимами полета.

### Racer
**Racer** — это модель дрона, оптимизированная для скоростного и маневренного полета, часто используемого в дрон-рейсинге.

- **Особенности**:
  - Очень маневренна и быстра.
  - Используется для разработки и тестирования алгоритмов управления для гонок дронов.

### Typhoon H480
**Typhoon H480** — это модель гексакоптера, часто используемого для коммерческого и профессионального применения, особенно в областях фотографии и видеосъемки.

- **Особенности**:
  - Большая несущая способность и стабильность в полете.
  - Часто оснащен высококачественными камерами и дополнительными датчиками.

Каждая из этих моделей может быть настроена и адаптирована к вашим нуждам через файлы конфигурации и скрипты запуска PX4. Использование этих моделей в симуляции Gazebo позволяет разработчикам тестировать системы управления и сценарии миссий в различных условиях без риска для реальных аппаратов.

# Добавление собственной модели

Для настройки вашей собственной модели дрона для использования в PX4 с симулятором Gazebo, вот последовательность шагов, которые нужно выполнить:

### Шаг 1: Подготовка Модели Дрона
1. **Создайте файл модели в формате SDF**:
   - Разработайте или получите SDF файл вашей модели дрона, который включает все физические параметры, необходимые для симуляции в Gazebo.

2. **Создание директории модели**:
   - В папке `Tools/simulation/gz/models` в репозитории PX4, создайте новую папку с названием вашей модели (например, `custom_drone`).

3. **Добавление ресурсов модели**:
   - Поместите файл SDF модели в созданную папку.
   - Добавьте дополнительные ресурсы, такие как текстуры ил другие файлы, необходимые для визуализации и функционирования модели.

4. **Файл `model.config`**:
   - Создайте файл `model.config` в директории вашей модели. Укажите в нём название модели, автора, описание и путь к файлу SDF.
   ```xml
   <?xml version="1.0"?>
   <model>
     <name>Custom Drone</name>
     <version>1.0</version>
     <sdf version="1.6">custom_drone.sdf</sdf>
     <author>
       <name>Your Name</name>
       <email>your.email@example.com</email>
     </author>
     <description>
       Description of your custom drone model.
     </description>
   </model>
   ```

### Шаг 2: Создание Скрипта Запуска
1. **Создайте скрипт запуска**:
   - В директории `ROMFS/px4fmu_common/init.d-posix/airframes/`, создайте новый файл скрипта запуска с уникальным идентификатором, например, `4012_gz_custom_drone`.
   - Пример содержимого скрипта:
   ```bash
   #!/bin/sh
   #
   # Custom Drone Startup Script for Gazebo Simulation
   #
   
   . ${R}etc/init.d/rc.fw_defaults  # Load default firmware settings

  PX4_SIMULATOR=${PX4_SIMULATOR:=gz}
  PX4_GZ_WORLD=${PX4_GZ_WORLD:=default}
  PX4_SIM_MODEL=${PX4_SIM_MODEL:=custom_model_base}s
   ```

### Шаг 3: Сборка и Запуск Симуляции
1. **Компиляция PX4 с вашей моделью**:
   - В корневой директории PX4 выполните команду:
   ```bash
   make px4_sitl_default gz_custom_drone
   ```
   Замените `custom_drone` на название вашей модели, как указано в вашем скрипте запуска.

2. **Запуск симуляции**:
   - Если все настроено правильно, команда запустит Gazebo с вашей моделью дрона, и вы сможете увидеть её в симуляторе.

### Шаг 4: Тестирование и Калибровка
1. **Тестирование в Gazebo**:
   - Используйте Gazebo и QGroundControl для тестирования поведения модели. Проверьте, как дрон реагирует на команды управления и как выполняются различные полетные режимы.

2. **Отладка и оптимизация**:
   - Отслеживайте логи и телеметрию для определения возможных проблем или для дальнейшей оптимизации параметров вашей модели.

Эти шаги позволят вам настроить и успешно интегрировать вашу собственную модель дрона для использования в симуляциях PX4 и Gazebo.