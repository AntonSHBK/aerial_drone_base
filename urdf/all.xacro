<?xml version="1.0" encoding="UTF-8"?>
<robot name="x500_base" xmlns:xacro="http://www.ros.org/wiki/xacro">

  <xacro:macro name="sensor_noise" params="mean stddev dynamic_bias_stddev dynamic_bias_correlation_time">
    <noise>
      <type>gaussian</type>
      <mean>${mean}</mean>
      <stddev>${stddev}</stddev>
      <dynamic_bias_stddev>${dynamic_bias_stddev}</dynamic_bias_stddev>
      <dynamic_bias_correlation_time>${dynamic_bias_correlation_time}</dynamic_bias_correlation_time>
    </noise>
  </xacro:macro>

  <link name="base_link">
    <inertial>
      <mass value="2.0"/>
      <inertia ixx="0.02166666666666667" ixy="0" ixz="0" iyy="0.02166666666666667" iyz="0" izz="0.04000000000000001"/>
    </inertial>
    <gravity>true</gravity>
    <velocity_decay/>
    <sensor name="air_pressure_sensor" type="air_pressure">
      <always_on>1</always_on>
      <update_rate>50</update_rate>
      <air_pressure>
        <pressure>
          <noise type="gaussian">
            <mean>0</mean>
            <stddev>0.01</stddev>
          </noise>
        </pressure>
      </air_pressure>
    </sensor>
    <sensor name="imu_sensor" type="imu">
      <always_on>1</always_on>
      <update_rate>250</update_rate>
      <imu>
        <angular_velocity>
          <xacro:sensor_noise mean="0" stddev="0.00018665" dynamic_bias_stddev="3.8785e-05" dynamic_bias_correlation_time="1000"/>
          <yacro:sensor_noise mean="0" stddev="0.00018665" dynamic_bias_stddev="3.8785e-05" dynamic_bias_correlation_time="1000"/>
          <zacro:sensor_noise mean="0" stddev="0.00018665" dynamic_bias_stddev="3.8785e-05" dynamic_bias_correlation_time="1000"/>
        </angular_velocity>
        <linear_acceleration>
          <xacro:sensor_noise mean="0" stddev="0.00186" dynamic_bias_stddev="0.006" dynamic_bias_correlation_time="300"/>
          <yacro:sensor_noise mean="0" stddev="0.00186" dynamic_bias_stddev="0.006" dynamic_bias_correlation_time="300"/>
          <zacro:sensor_noise mean="0" stddev="0.00186" dynamic_bias_stddev="0.006" dynamic_bias_correlation_time="300"/>
        </linear_acceleration>
      </imu>
    </sensor>
    <sensor name="navsat_sensor" type="navsat">
      <always_on>1</always_on>
      <update_rate>30</update_rate>
    </sensor>
  </link>

  <link name="rotor_0">
    <gravity>true</gravity>
    <self_collide>false</self_collide>
    <velocity_decay/>
    <pose>0.174 -0.174 0.06 0 0 0</pose>
    <inertial>
      <mass value="0.016076923076923075"/>
      <inertia ixx="3.8464910483993325e-07" ixy="0" ixz="0" iyy="2.6115851691700804e-05" iyz="0" izz="2.649858234714004e-05"/>
    </inertial>
    <collision name="rotor_0_collision">
      <pose>0 0 0 0 0 0</pose>
      <geometry>
        <box>
          <size>0.2792307692307692 0.016923076923076923 0.0008461538461538462</size>
        </box>
      </geometry>
      <surface>
        <contact>
          <ode>
            <min_depth>0.001</min_depth>
            <max_vel>0</max_vel>
          </ode>
        </contact>
        <friction>
          <ode/>
        </friction>
      </surface>
    </collision>
  </link>

  <joint name="rotor_0_joint" type="revolute">
    <parent link="base_link"/>
    <child link="rotor_0"/>
    <axis>
      <xyz>0 0 1</xyz>
      <limit lower="-1e+16" upper="1e+16"/>
      <dynamics spring_reference="0" spring_stiffness="0"/>
    </axis>
  </joint>

  <gazebo>
    <plugin filename="gz-sim-multicopter-motor-model-system" name="gz::sim::systems::MulticopterMotorModel">
      <jointName>rotor_0_joint</jointName>
      <linkName>rotor_0</linkName>
      <turningDirection>ccw</turningDirection>
      <timeConstantUp>0.0125</timeConstantUp>
      <timeConstantDown>0.025</timeConstantDown>
      <maxRotVelocity>1000.0</maxRotVelocity>
      <motorConstant>8.54858e-06</motorConstant>
      <momentConstant>0.016</momentConstant>
      <commandSubTopic>command/motor_speed</commandSubTopic>
      <motorNumber>0</motorNumber>
      <rotorDragCoefficient>8.06428e-05</rotorDragCoefficient>
      <rollingMomentCoefficient>1e-06</rollingMomentCoefficient>
      <rotorVelocitySlowdownSim>10</rotorVelocitySlowdownSim>
      <motorType>velocity</motorType>
    </plugin>
  </gazebo>

</robot>
